<html>
  <head>
    <script type="module">
      import {render} from './render.js';

      document.addEventListener('DOMContentLoaded', async event => {
        const credential = {
          '@context': [
            'https://www.w3.org/ns/credentials/v2',
            'https://www.w3.org/ns/credentials/examples/v2'
          ],
          type: ['VerifiableCredential', 'NameCredential'],
          issuer: {
            id: 'did:example:1234',
            name: 'The Issuer',
          },
          credentialSubject: {
            name: 'Example Name',
            notRendered: 'should not appear'
          },
          renderMethod: {
            type: 'TemplateRenderMethod',
            renderEngine: 'html',
            renderProperty: [
              '/issuer/name',
              '/credentialSubject/name'
            ],
            template: {
              id:
                'https://test.example/credential-templates/NameCredential.html',
              mediaType: 'text/html',
              digestMultibase:
                'zQmerWC85Wg6wFl9znFCwYxApG270iEu5h6JqWAPdhyxz2dR'
            },
            outputPreference: {
              mode: ['visual', 'audio'],
              mediaType: 'application/html',
              // FIXME: TBD
              style: {width: '800px', height: '800px'}
            }
          }
        };
        const renderMethod = credential.renderMethod;
        // FIXME: dereference template from `renderMethod.id`
        const template = `
          <div>
            <script>
              console.log('running template render script');
              const credential = JSON.parse(document.querySelector(
                'head > script[name="credential"]').innerHTML);
              document.querySelector('#content').innerHTML =
                JSON.stringify(credential, null, 2);
              window.renderMethodReady();
            <\/script>
            <div>
              <pre id="content"></pre>
            </div>
          </div>`;
        const {iframe} = await render({
          credential,
          renderProperty: renderMethod.renderProperty,
          renderMethodReady() {
            console.log('rendering ready');
          },
          template
        });
        const {style} = renderMethod.outputPreference;
        for(const key in style) {
          iframe.style[key] = style[key];
        }
        document.querySelector('#display').appendChild(iframe);
      });
    </script>
  </head>
  <body>
    <div>HTML Render Method Test</div>
    <div id="display"></div>
  </body>
</html>
